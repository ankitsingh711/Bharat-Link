generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id               String    @id @default(uuid())
  email            String    @unique
  phoneNumber      String?   @unique
  name             String
  headline         String?
  summary          String?
  location         String?
  profileImage     String?
  resume           String?   @map("resume_key")
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Professional
  experience       Experience[]
  education        Education[]
  skills           Skill[]

  // Relations
  applications     Application[]
  jobsPosted       Job[]          @relation("JobsPosted")
  posts            Post[]
  comments         Comment[]
  likes            Like[]
  
  // Connections (Self-relation)
  followedBy       Connection[] @relation("followedBy")
  following        Connection[] @relation("following")

  // Messaging
  conversations    ConversationParticipant[]
}

model Company {
  id          String   @id @default(uuid())
  name        String
  domain      String?
  gstNumber   String?  @unique
  cin         String?  @unique
  verified    Boolean  @default(false)
  logo        String?
  about       String?
  location    String?
  size        String?
  industry    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  jobs        Job[]
  users       CompanyUser[] // Recruiters/Admins
}

model CompanyUser {
  id        String   @id @default(uuid())
  userId    String
  companyId String
  role      Role     @default(MEMBER)
  
  company   Company  @relation(fields: [companyId], references: [id])
}

model Job {
  id             String    @id @default(uuid())
  companyId      String
  postedById     String
  title          String
  description    String
  location       String?
  salaryRange    String?
  employmentType String?   // FULL_TIME, PART_TIME, etc.
  requirements   String[]
  isSponsored    Boolean   @default(false)
  createdAt      DateTime  @default(now())
  expiresAt      DateTime?

  company        Company   @relation(fields: [companyId], references: [id])
  postedBy       User      @relation("JobsPosted", fields: [postedById], references: [id])
  applications   Application[]
}

model Application {
  id          String   @id @default(uuid())
  jobId       String
  userId      String
  resume      String?
  coverLetter String?
  status      ApplicationStatus @default(APPLIED)
  score       Int?
  appliedAt   DateTime @default(now())

  job         Job      @relation(fields: [jobId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
}

model Post {
  id        String   @id @default(uuid())
  authorId  String
  content   String
  media     String[] // S3 keys
  likesCount Int     @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  author    User     @relation(fields: [authorId], references: [id])
  comments  Comment[]
  likes     Like[]
}

model Comment {
  id        String   @id @default(uuid())
  postId    String
  authorId  String
  content   String
  createdAt DateTime @default(now())

  post      Post     @relation(fields: [postId], references: [id])
  author    User     @relation(fields: [authorId], references: [id])
}

model Like {
  id        String   @id @default(uuid())
  postId    String
  userId    String

  post      Post     @relation(fields: [postId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([postId, userId])
}

model Connection {
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  status      ConnectionStatus @default(PENDING)
  createdAt   DateTime @default(now())

  follower    User     @relation("following", fields: [followerId], references: [id])
  following   User     @relation("followedBy", fields: [followingId], references: [id])

  @@unique([followerId, followingId])
}

// Messaging
model Conversation {
  id           String   @id @default(uuid())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  participants ConversationParticipant[]
  messages     Message[]
}

model ConversationParticipant {
  conversationId String
  userId         String
  joinedAt       DateTime @default(now())

  conversation   Conversation @relation(fields: [conversationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  @@id([conversationId, userId])
}

model Message {
  id             String   @id @default(uuid())
  conversationId String
  senderId       String
  content        String
  createdAt      DateTime @default(now())
  
  conversation   Conversation @relation(fields: [conversationId], references: [id])
}

// Helper Models

model Experience {
  id          String   @id @default(uuid())
  userId      String
  title       String
  company     String
  startDate   DateTime
  endDate     DateTime?
  description String?
  
  user        User     @relation(fields: [userId], references: [id])
}

model Education {
  id          String   @id @default(uuid())
  userId      String
  school      String
  degree      String
  field       String
  startDate   DateTime
  endDate     DateTime?
  
  user        User     @relation(fields: [userId], references: [id])
}

model Skill {
  id     String @id @default(uuid())
  userId String
  name   String
  
  user   User   @relation(fields: [userId], references: [id])
}

enum Role {
  ADMIN
  RECRUITER
  MEMBER
}

enum ApplicationStatus {
  APPLIED
  REVIEWING
  SHORTLISTED
  REJECTED
  HIRED
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  IGNORED
}
